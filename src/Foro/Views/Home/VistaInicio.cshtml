@using Foro.Models
@using Foro.Controllers;

@{
    List<Preguntas> hilosMasRespondidos = new PreguntasController().HilosMasRespondidos();

    int contador = 0;
    string rango = "";

    if (Session["usuario"] != null)
    {
        int idUsuario = ((Usuarios)Session["usuario"]).idUsuario;
        rango = new UsuarioController().GetRango(idUsuario);
    }
}

<div id="divCategorias" onloadedmetadata="cargarBarra()">
    <div id="todasCategorias">
        <h2>Categorías</h2>
        <br />
        @foreach (var datosC in new CategoriaController().ListarCategorías())
        {
            <a href="@Url.Action("VerCategoria", "Categoria", new {idCategoria = datosC.idCategoria, categoria = datosC.nombre})" id="enlaceCategorias">
                <div class="filaCategoria">
                    <img src="~/Content/img/@(datosC.imagen).svg" />
                    <div class="datosCategorias">
                        <span class="tituloCategoria">@datosC.nombre</span>
                        <br />
                        <span>@datosC.descripcion</span>
                    </div>
                    <div id="contadorPreguntas">
                        @(new PreguntasController().ContarPreguntas(datosC.idCategoria)) preguntas
                    </div>
                </div>
            </a>
            <hr />
        }
    </div>
    <div class="otrasCategorias">
        <div id="preguntasDestacadas">
            <h3 id="hilosRespondidos">Hilos más respondidos</h3>
            @foreach (var masRespondidos in hilosMasRespondidos)
            {
                if (contador == 5)
                {
                    break;
                }
                <div class="filasMasRespodidos">
                    <span class="tituloNombrePregunta">
                        @masRespondidos.titulo
                    </span>
                    <div class="contenidoAdicional">
                        <span>@masRespondidos.Comentarios.Count respuestas</span>
                        <a class="enlaceVerHilo" href="@Url.Action("VerPregunta", "Preguntas", new {idPregunta = masRespondidos.idPregunta})">Ver Hilo >></a>
                    </div>
                </div>
                <br />
                contador++;
            }
            <a id="btnVerMasHilos">VER MAS</a>
        </div>
        <div id="estadoRol">
            <h3>Tu progreso</h3>
            @if (Session["usuario"] == null)
            {
                <span>Inicia sesión para ver tu progreso</span>
            }
            else
            {
                <div>
                    Actualmente eres: <span>@rango</span>                    
                </div>
            }
        </div>
    </div>
</div>


